<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>fis3 | 糯米馨的自留地</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="边看边记录吧，岁数大了，记性不行了">
<meta name="keywords" content="笔记">
<meta property="og:type" content="article">
<meta property="og:title" content="fis3">
<meta property="og:url" content="http://nuomixin.duapp.com/2015/10/16/fis3/index.html">
<meta property="og:site_name" content="糯米馨的自留地">
<meta property="og:description" content="边看边记录吧，岁数大了，记性不行了">
<meta property="og:locale" content="zh-Hans">
<meta property="og:updated_time" content="2018-01-08T03:42:49.980Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="fis3">
<meta name="twitter:description" content="边看边记录吧，岁数大了，记性不行了">
  
    <link rel="alternative" href="/atom.xml" title="糯米馨的自留地" type="application/atom+xml">
  
  
    <link rel="icon" href="http://7sbkqu.com1.z0.glb.clouddn.com/favicon.png">
  
  <link rel="stylesheet" href="/blog/css/style.css">
  
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?4219fe391086c4deee240ad4925736b6";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>


</head>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img src="http://7sbkqu.com1.z0.glb.clouddn.com/avatar.jpg" class="js-avatar" style="width: 100%;height: 100%;opacity: 1;">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">糯米馨</a></h1>
		</hgroup>

		
		<p class="header-subtitle">无可救药的声控斯基</p>
		

		
			<div class="switch-btn">
				<div class="icon">
					<div class="icon-ctn">
						<div class="icon-wrap icon-house" data-idx="0">
							<div class="birdhouse"></div>
							<div class="birdhouse_holes"></div>
						</div>
						<div class="icon-wrap icon-ribbon hide" data-idx="1">
							<div class="ribbon"></div>
						</div>
						
						<div class="icon-wrap icon-link hide" data-idx="2">
							<div class="loopback_l"></div>
							<div class="loopback_r"></div>
						</div>
						
						
						<div class="icon-wrap icon-me hide" data-idx="3">
							<div class="user"></div>
							<div class="shoulder"></div>
						</div>
						
					</div>
					
				</div>
				<div class="tips-box hide">
					<div class="tips-arrow"></div>
					<ul class="tips-inner">
						<li>菜单</li>
						<li>标签</li>
						
						<li>友情链接</li>
						
						
						<li>关于我</li>
						
					</ul>
				</div>
			</div>
		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/blog/archives/index.html">所有文章</a></li>
				        
							<li><a href="/blog/tags/亲测/index.html">亲测</a></li>
				        
							<li><a href="/blog/tags/前端/index.html">前端</a></li>
				        
							<li><a href="/blog/tags/tips/index.html">Tips</a></li>
				        
							<li><a href="/blog/tags/笔记/index.html">笔记</a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
								<a class="github" target="_blank" href="https://github.com/trytuorisfy" title="github">github</a>
					        
								<a class="weibo" target="_blank" href="http://weibo.com/1933249531" title="weibo">weibo</a>
					        
								<a class="mail" target="_blank" href="mailto:tuorisfy@gmail.com" title="mail">mail</a>
					        
						</div>
					</nav>
				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						<a href="/blog/tags/study/" style="font-size: 10px;">study</a> <a href="/blog/tags/tips/" style="font-size: 12px;">tips</a> <a href="/blog/tags/亲测/" style="font-size: 18px;">亲测</a> <a href="/blog/tags/出去浪/" style="font-size: 10px;">出去浪</a> <a href="/blog/tags/前端/" style="font-size: 20px;">前端</a> <a href="/blog/tags/剧集/" style="font-size: 10px;">剧集</a> <a href="/blog/tags/后端/" style="font-size: 12px;">后端</a> <a href="/blog/tags/图片/" style="font-size: 10px;">图片</a> <a href="/blog/tags/声控/" style="font-size: 10px;">声控</a> <a href="/blog/tags/笔记/" style="font-size: 16px;">笔记</a> <a href="/blog/tags/美色/" style="font-size: 10px;">美色</a> <a href="/blog/tags/随手记/" style="font-size: 10px;">随手记</a> <a href="/blog/tags/随拍/" style="font-size: 14px;">随拍</a> <a href="/blog/tags/音乐/" style="font-size: 10px;">音乐</a>
					</div>
				</section>
				
				
				
				<section class="switch-part switch-part3">
					<div id="js-friends">
					
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://www.sunxichen.com">我男神的博客</a>
			        
			        </div>
				</section>
				

				
				
				<section class="switch-part switch-part4">
				
					<div id="js-aboutme">无可救药的声控斯基</div>
				</section>
				
			</div>
		</div>
	</header>				
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide">糯米馨</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				<img lazy-src="http://7sbkqu.com1.z0.glb.clouddn.com/avatar.jpg" class="js-avatar">
			</div>
			<hgroup>
			  <h1 class="header-author">糯米馨</h1>
			</hgroup>
			
			<p class="header-subtitle">无可救药的声控斯基</p>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/blog/archives/index.html">所有文章</a></li>
		        
					<li><a href="/blog/tags/亲测/index.html">亲测</a></li>
		        
					<li><a href="/blog/tags/前端/index.html">前端</a></li>
		        
					<li><a href="/blog/tags/tips/index.html">Tips</a></li>
		        
					<li><a href="/blog/tags/笔记/index.html">笔记</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="https://github.com/trytuorisfy" title="github">github</a>
			        
						<a class="weibo" target="_blank" href="http://weibo.com/1933249531" title="weibo">weibo</a>
			        
						<a class="mail" target="_blank" href="mailto:tuorisfy@gmail.com" title="mail">mail</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>
      <div class="body-wrap"><article id="post-fis3" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/blog/2015/10/16/fis3/" class="article-date">
  	<time datetime="2015-10-16T02:05:26.000Z" itemprop="datePublished">2015-10-16</time>
</a>
    </div>
  
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      fis3
    </h1>
  

      </header>
      
      <div class="article-info article-info-post">
        
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/笔记/">笔记</a></li></ul>
	</div>

        

        <div class="clearfix"></div>
      </div>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>边看边记录吧，岁数大了，记性不行了<br><a id="more"></a><br>配置文件：fis-config.js</p>
<h2 id="发布"><a href="#发布" class="headerlink" title="发布"></a>发布</h2><pre><code>//发布到本地
fis3 release -d &lt;path&gt;//示例 fis3 release -d ../output(发布到上级目录的output文件夹)

//发布到远程机器（修改配置文件）
fis.match(&apos;*&apos;, {
  deploy: fis.plugin(&apos;http-push&apos;, {
    receiver: &apos;http://cq.01.p.p.baidu.com:8888/receiver.php&apos;,
    to: &apos;/home/work/htdocs&apos; // 注意这个是指的是测试机器的路径，而非本地机器
  })
})    
</code></pre><h2 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h2><pre><code>// fis-config.js

//配置文件发布位置
fis.match(&apos;*.{png,js,css}&apos;, {
  release: &apos;/static/$0&apos;
});

//增加md5戳
fis.match(&apos;*.{js,css,png}&apos;, {
  useHash: true
});

//资源压缩
fis.match(&apos;*.js&apos;, {
  // fis-optimizer-uglify-js 插件进行压缩，已内置
  optimizer: fis.plugin(&apos;uglify-js&apos;)
});

fis.match(&apos;*.css&apos;, {
  // fis-optimizer-clean-css 插件进行压缩，已内置
  optimizer: fis.plugin(&apos;clean-css&apos;)
});

fis.match(&apos;*.png&apos;, {//题外话 妈妈再也不用担心我的压缩图片问题了
  // fis-optimizer-png-compressor 插件进行压缩，已内置
  optimizer: fis.plugin(&apos;png-compressor&apos;)
});    

//CssSprite图片合并(仅对CSS 中路径带 ?__sprite图片并且分配到 useSprite: true 的 CSS 文件才会被处理)
// 启用 fis-spriter-csssprites 插件
fis.match(&apos;::package&apos;, {
  spriter: fis.plugin(&apos;csssprites&apos;)
})

// 对 CSS 进行图片合并
fis.match(&apos;*.css&apos;, {
  // 给匹配到的文件分配属性 `useSprite`
  useSprite: true
})    

//如果开发环境不需要如上功能，再加上下面这段
fis.media(&apos;debug&apos;).match(&apos;*.{js,css,png}&apos;, {
  useHash: false,
  useSprite: false,
  optimizer: null
})
</code></pre><h2 id="调试"><a href="#调试" class="headerlink" title="调试"></a>调试</h2><pre><code>//启动服务
fis3 server start // http://127.0.0.1:8080(默认)   //惊喜，竟然还生成了一个外网可以访问的地址，太棒了！

//发布
fis3 release //不加 -d 参数默认被发布到内置 Web Server的根目录下，当启动服务时访问此目录下的资源。

//文件监听
fis3 release -w

//浏览器自动刷新
fis3 release -wL    

//打开内置web server目录
fis3 server open

//更多参数 
fis3 server -h //start stop restart info open clean install(name)
</code></pre><h2 id="嵌入资源"><a href="#嵌入资源" class="headerlink" title="嵌入资源"></a><a href="http://fis.baidu.com/fis3/docs/user-dev/inline.html" target="_blank" rel="noopener">嵌入资源</a></h2><h2 id="插件"><a href="#插件" class="headerlink" title="插件"></a>插件</h2><pre><code>//less预处理
npm install -g fis-parser-less //安装插件（html直接引入.less文件）
//配置文件
fis.match(&apos;*.less&apos;, {
  // fis-parser-less 插件进行解析
  parser: fis.plugin(&apos;less&apos;),
  // .less 文件后缀构建后被改成 .css 文件
  rExt: &apos;.css&apos;
})
</code></pre><p><a href="http://fis.baidu.com/fis3/docs/lv1.html" target="_blank" rel="noopener">简单打包</a>，有基于整个项目和基于页面的，我觉得基于页面的挺实用的，简单粗暴O(∩_∩)O</p>
<pre><code>//简单打包
//插件装起来
npm install -g fis3-postpackager-loader
//配置文件一：整个项目都打在一起，成为一个css和一个js
fis.match(&apos;::package&apos;, {
  postpackager: fis.plugin(&apos;loader&apos;)
});
fis.match(&apos;*.{less,css}&apos;, {
  packTo: &apos;/static/aio.css&apos;
});
fis.match(&apos;*.js&apos;, {
  packTo: &apos;/static/aio.js&apos;
});
//配置文件二：基于页面的打包
fis.match(&apos;::package&apos;, {
  postpackager: fis.plugin(&apos;loader&apos;, {
    allInOne: true
  })
});
</code></pre><h2 id="零散知识"><a href="#零散知识" class="headerlink" title="零散知识"></a>零散知识</h2><p><a href="https://segmentfault.com/q/1010000003860300" target="_blank" rel="noopener">时间戳</a></p>
<pre><code>//fis-conf.js
fis.set(&apos;date&apos;, new Date);
fis.match(&apos;*.{js,css,png,jpg}&apos;, {
    query: &apos;?t=&apos; + (fis.get(&apos;date&apos;).getYear() + 1900) 
                 + (fis.get(&apos;date&apos;).getMonth() + 1) 
                 + (fis.get(&apos;date&apos;).getDate())
                 + (fis.get(&apos;date&apos;).getHours())
                 + (fis.get(&apos;date&apos;).getMinutes())
});
</code></pre><p><a href="https://github.com/fex-team/fis3-hook-relative" target="_blank" rel="noopener">相对地址插件</a></p>
<pre><code>//fis-conf.js
// 启用插件
fis.hook(&apos;relative&apos;);

// 让所有文件，都使用相对路径。
fis.match(&apos;**&apos;, {
  relative: true
})
</code></pre><h3 id="增加md5戳"><a href="#增加md5戳" class="headerlink" title="增加md5戳"></a>增加md5戳</h3><p>在网上搜了一遍，没啥办法，突然发现个地方说其实可以改源码，<a href="http://www.longlong.asia/2015/09/20/fis3-static-control.html" target="_blank" rel="noopener">我的灵感来源</a><br>直接贴测试成功的修改方式，就改2个地方就可以了<br>修改fis3里面的lib/file.js文件</p>
<pre><code>//fis3中的lib/file.js
//修改一 在60行左右
function addHash(path, file) {
  var rExt = file.rExt,
    qRExt = fis.util.escapeReg(rExt),
    qExt = fis.util.escapeReg(file.ext),
    hash = file.getHash(),
    onnector = fis.media().get(&apos;project.md5Connector&apos;, &apos;_&apos;),
    reg = new RegExp(qRExt + &apos;$|&apos; + qExt + &apos;$&apos;, &apos;i&apos;);
  // return path.replace(reg, &apos;&apos;) + onnector + hash + rExt;//原始版
  return path;//md5版，文件名保持不变
}
//修改二 在480行左右
getUrl: function() {
    var url = this.url;
    if (this.useHash) {
      // url = addHash(url, this); //原始版
      url += &apos;?&apos; + this.getHash(); //md5版
}

//项目中的配置文件 fis-conf.js
//md5戳可用 了
fis.match(&apos;*.{js,css,png,jpg}&apos;, {
  useHash: true
});
</code></pre><p>最后叨逼一句，度受的源代码的注释写的太棒了，让我个渣渣也找到地方改了</p>

      
    </div>
    
  </div>
  
    
<nav id="article-nav">
  
    <a href="/blog/2015/10/19/前端交流会归来/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption"><</strong>
      <div class="article-nav-title">
        
          前端交流会归来
        
      </div>
    </a>
  
  
    <a href="/blog/2015/10/13/websoket/" id="article-nav-older" class="article-nav-link-wrap">
      <div class="article-nav-title">websoket</div>
      <strong class="article-nav-caption">></strong>
    </a>
  
</nav>

  
</article>








  <section id="comments" style="margin:30px;padding:10px;background:#fff;">
    <div id="vcomment" class="comment"></div> 
<script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
<script src="//unpkg.com/valine/dist/Valine.min.js"></script>
<script>
   var notify = 'false' == true ? true : false;
   var verify = 'false' == true ? true : false;
    window.onload = function() {
        new Valine({
            el: '#vcomment',
            notify: notify,
            verify: verify,
            app_id: "iQD3W24cfvu1WB82GuUFQoVc-gzGzoHsz",
            app_key: "nOw3zLema3nK8AjxW5OlajW1",
            placeholder: "",
            avatar:"mm"
        });
    }
</script>
  </section>

</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2018 糯米馨
    	</div>
      	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
          由<a href="http://www.qiniu.com/">七牛云</a>提供静态存储
          沪ICP备15018744号-1
      	</div>
    </div>
  </div>
</footer>
    </div>
    

<script>
	var yiliaConfig = {
		fancybox: false,
		mathjax: false,
		animate: false,
		isHome: false,
		isPost: true,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false
	}
</script>
<script src="http://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js"></script>
<script src="/blog/js/main.js"></script>






  </div>
</body>
</html>